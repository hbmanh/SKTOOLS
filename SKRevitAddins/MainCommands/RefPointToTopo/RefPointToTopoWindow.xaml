<Window x:Class="SKRevitAddins.RefPointToTopo.RefPointToTopoWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="RefPoint → Toposolid"
        Height="520" Width="760"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Language="en-US">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolVis"/>

        <!-- Kiểu -->
        <Style x:Key="H1" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="Label" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>
        <Style x:Key="Tbx" TargetType="TextBox">
            <Setter Property="Height" Value="26"/>
            <Setter Property="Margin" Value="0,0,16,8"/>
        </Style>
        <Style x:Key="Chk" TargetType="CheckBox">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,16,8"/>
        </Style>
        <Style x:Key="ActionBtn" TargetType="Button">
            <Setter Property="Height" Value="34"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
            <Setter Property="Padding" Value="12,4"/>
        </Style>
        <Style x:Key="PrimaryBtn" BasedOn="{StaticResource ActionBtn}" TargetType="Button">
            <Setter Property="Background" Value="#28A745"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#28A745"/>
        </Style>
        <Style x:Key="GhostBtn" BasedOn="{StaticResource ActionBtn}" TargetType="Button">
            <Setter Property="Background" Value="#F2F2F2"/>
            <Setter Property="BorderBrush" Value="#D0D0D0"/>
        </Style>
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E5E5E5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,8,0,0"/>
        </Style>
    </Window.Resources>

    <Grid Background="#FAFBFC">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <DockPanel Margin="16" LastChildFill="False">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                <Image Source="pack://application:,,,/Resources/shinken.png"
                       Width="28" Height="28" Stretch="Uniform"/>
                <TextBlock Text="Shinken Group®" Style="{StaticResource H1}" Margin="10,0,0,0"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                <Button Content="Chọn Toposolid" Style="{StaticResource GhostBtn}" Command="{Binding PickTopoCmd}"/>
                <TextBlock Text="Mã:" Margin="12,0,6,0" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding TargetTopoText}" FontWeight="Bold" VerticalAlignment="Center"/>
            </StackPanel>
        </DockPanel>

        <!-- BODY -->
        <ScrollViewer Grid.Row="1" Margin="16,0,16,16">
            <StackPanel>
                <Border Style="{StaticResource Card}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Family RefPoint" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding RefPointFamilyName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="IDW - số lân cận (K)" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding IDW_K, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="Lấy mẫu thích ứng" Style="{StaticResource Label}"/>
                            <CheckBox IsChecked="{Binding UseAdaptiveSampling}" Style="{StaticResource Chk}"/>

                            <TextBlock Text="Hệ số tinh chỉnh" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding RefineFactor, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Bước lưới (mm)" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding GridSpacingMillimeters, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="Khoảng bắt (mm)" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding SnapDistanceMillimeters, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="Ngưỡng độ dốc" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding GradThreshold, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="Số điểm tinh chỉnh tối đa" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding MaxRefinePoints, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Bước biên (mm)" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding EdgeSpacingMillimeters, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="IDW - lũy thừa" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding IDW_Power, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>

                            <TextBlock Text="IDW song song" Style="{StaticResource Label}"/>
                            <CheckBox IsChecked="{Binding UseParallelIDW}" Style="{StaticResource Chk}"/>

                            <TextBlock Text="Số điểm tối đa" Style="{StaticResource Label}"/>
                            <TextBox Text="{Binding MaxPoints, UpdateSourceTrigger=PropertyChanged, ConverterCulture=en-US}" Style="{StaticResource Tbx}"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Thêm Checkbox -->
                <Border Style="{StaticResource Card}">
                    <StackPanel Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding CreateTopoFromRefPointOnly}" Style="{StaticResource Chk}" />
                        <TextBlock Text="Chỉ tạo Topo từ RefPoint (không tạo các điểm khác)" Style="{StaticResource Label}"/>
                    </StackPanel>
                </Border>

                <!-- Trạng thái -->
                <Border Style="{StaticResource Card}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Đang xử lý..." VerticalAlignment="Center"
                                   Visibility="{Binding IsBusy, Converter={StaticResource BoolVis}}"/>
                        <ProgressBar Height="18" Width="240" Margin="12,0,0,0"
                                     Minimum="0" Maximum="1" Value="{Binding Progress}"
                                     Visibility="{Binding IsBusy, Converter={StaticResource BoolVis}}"/>
                        <Button Content="Hủy" Style="{StaticResource GhostBtn}" Margin="12,0,0,0"
                                Command="{Binding CancelCmd}"
                                Visibility="{Binding IsBusy, Converter={StaticResource BoolVis}}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- FOOTER -->
        <DockPanel Grid.Row="2" Margin="16,0,16,16" LastChildFill="False">
            <Button Content="THỰC HIỆN" Style="{StaticResource PrimaryBtn}" DockPanel.Dock="Right"
                    Command="{Binding RunCmd}"/>
        </DockPanel>
    </Grid>
</Window>
